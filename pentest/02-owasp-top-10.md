# üõ°Ô∏è OWASP Top 10 (2021)

> 10 l·ªó h·ªïng b·∫£o m·∫≠t web ph·ªï bi·∫øn nh·∫•t - B·∫ÆT BU·ªòC ph·∫£i thu·ªôc!

---

## A01: Broken Access Control

### M√¥ t·∫£
Khi user c√≥ th·ªÉ truy c·∫≠p ho·∫∑c th·ª±c hi·ªán actions m√† h·ªç kh√¥ng ƒë∆∞·ª£c ph√©p.

### V√≠ d·ª• th·ª±c t·∫ø

**1. IDOR (Insecure Direct Object Reference)**
```http
# User A ƒëƒÉng nh·∫≠p, xem profile c·ªßa m√¨nh
GET /api/users/123/profile

# User A thay ƒë·ªïi ID ƒë·ªÉ xem profile user kh√°c
GET /api/users/456/profile  ‚Üê VULNERABLE!
```

**2. Privilege Escalation**
```http
# Normal user th·ª≠ access admin endpoint
GET /api/admin/users
Authorization: Bearer <normal_user_token>

# Server kh√¥ng check role ‚Üí Tr·∫£ v·ªÅ data!
```

**3. Forced Browsing**
```
# URL admin kh√¥ng ƒë∆∞·ª£c link nh∆∞ng v·∫´n accessible
https://example.com/admin/dashboard
```

### C√°ch test
- Thay ƒë·ªïi ID trong URL/request body
- Th·ª≠ access c√°c endpoint c·ªßa role kh√°c
- Thay ƒë·ªïi HTTP method (GET ‚Üí PUT, DELETE)
- X√≥a ho·∫∑c modify access token

### Prevention
```javascript
// ‚úÖ Always check authorization
app.get('/api/users/:id', (req, res) => {
  if (req.user.id !== req.params.id && !req.user.isAdmin) {
    return res.status(403).json({ error: 'Forbidden' });
  }
  // ... proceed
});
```

---

## A02: Cryptographic Failures

### M√¥ t·∫£
S·ª≠ d·ª•ng m√£ h√≥a y·∫øu ho·∫∑c kh√¥ng m√£ h√≥a data nh·∫°y c·∫£m.

### V√≠ d·ª•

**1. Sensitive Data Exposure**
```javascript
// ‚ùå Password trong log
console.log(`User login: ${email}, password: ${password}`);

// ‚ùå API tr·∫£ v·ªÅ password hash
res.json({ user: { id, email, passwordHash } });
```

**2. Weak Algorithms**
```javascript
// ‚ùå MD5 cho passwords
const hash = crypto.createHash('md5').update(password).digest('hex');

// ‚úÖ D√πng bcrypt
const hash = await bcrypt.hash(password, 10);
```

**3. Hardcoded Secrets**
```javascript
// ‚ùå Secret trong code
const JWT_SECRET = "super_secret_key_123";

// ‚úÖ D√πng environment variables
const JWT_SECRET = process.env.JWT_SECRET;
```

### C√°ch test
- Ki·ªÉm tra data in transit (c√≥ HTTPS kh√¥ng?)
- Review database encryption
- T√¨m hardcoded secrets trong code
- Check password storage mechanism

---

## A03: Injection

### M√¥ t·∫£
Attacker inject malicious code/commands th√¥ng qua user input.

### C√°c lo·∫°i Injection

#### SQL Injection
```javascript
// ‚ùå Vulnerable
const query = `SELECT * FROM users WHERE email = '${email}'`;

// Input: ' OR '1'='1
// Becomes: SELECT * FROM users WHERE email = '' OR '1'='1'
```

```javascript
// ‚úÖ Parameterized Query
const query = 'SELECT * FROM users WHERE email = $1';
db.query(query, [email]);
```

#### Command Injection
```javascript
// ‚ùå Vulnerable
exec(`ping ${userInput}`);

// Input: google.com; rm -rf /
// Executes: ping google.com; rm -rf /
```

#### NoSQL Injection
```javascript
// ‚ùå Vulnerable
db.users.find({ email: req.body.email, password: req.body.password });

// Input: { "$ne": "" }
// Matches all documents!
```

### C√°ch test
- Th√™m `'` ho·∫∑c `"` v√†o input fields
- Th·ª≠ c√°c payload nh∆∞ `' OR '1'='1`
- Test v·ªõi special characters: `; | & $ > <`

---

## A04: Insecure Design

### M√¥ t·∫£
Thi·∫øu security controls trong giai ƒëo·∫°n design.

### V√≠ d·ª•

**1. Missing Rate Limiting**
```
# Attacker brute-force password
POST /api/login  (attempt 1)
POST /api/login  (attempt 2)
...
POST /api/login  (attempt 10000) ‚Üê No protection!
```

**2. Unlimited Resource Allocation**
```javascript
// ‚ùå No file size limit
app.post('/upload', upload.single('file'));

// ‚úÖ With limit
app.post('/upload', upload.single('file', { limits: { fileSize: 5 * 1024 * 1024 } }));
```

**3. Missing Business Logic Validation**
```javascript
// ‚ùå Ch·ªâ check s·ªë d∆∞∆°ng
if (amount > 0) {
  transferMoney(fromAccount, toAccount, amount);
}

// Kh√¥ng check: fromAccount c√≥ ƒë·ªß ti·ªÅn kh√¥ng?
// Kh√¥ng check: fromAccount thu·ªôc v·ªÅ user hi·ªán t·∫°i kh√¥ng?
```

---

## A05: Security Misconfiguration

### M√¥ t·∫£
C·∫•u h√¨nh b·∫£o m·∫≠t sai ho·∫∑c kh√¥ng ƒë·∫ßy ƒë·ªß.

### Common Issues

**1. Verbose Error Messages**
```javascript
// ‚ùå L·ªô stack trace
app.use((err, req, res, next) => {
  res.status(500).json({ error: err.stack });
});

// ‚úÖ Generic error
app.use((err, req, res, next) => {
  console.error(err);
  res.status(500).json({ error: 'Internal Server Error' });
});
```

**2. Default Credentials**
```
# Default admin accounts
admin:admin
root:root
admin:password123
```

**3. Unnecessary Features Enabled**
- Directory listing enabled
- Debug mode in production
- Unused HTTP methods allowed
- Default sample files not removed

**4. Missing Security Headers**
```javascript
// ‚úÖ S·ª≠ d·ª•ng helmet
const helmet = require('helmet');
app.use(helmet());
```

---

## A06: Vulnerable and Outdated Components

### M√¥ t·∫£
S·ª≠ d·ª•ng libraries/frameworks c√≥ l·ªó h·ªïng ƒë√£ bi·∫øt.

### C√°ch ki·ªÉm tra

**NPM Projects:**
```bash
# Check vulnerabilities
npm audit

# Auto-fix
npm audit fix

# Force fix (c√≥ th·ªÉ breaking)
npm audit fix --force
```

**Check specific package:**
```bash
# Xem versions v√† vulnerabilities
npm view lodash versions
npm audit --json | grep lodash
```

### Tools
- **Snyk**: https://snyk.io
- **Dependabot**: GitHub built-in
- **OWASP Dependency-Check**

### Prevention
- Regularly update dependencies
- Subscribe to security advisories
- Use `npm audit` in CI/CD pipeline

---

## A07: Identification and Authentication Failures

### M√¥ t·∫£
L·ªó h·ªïng trong authentication flow.

### Common Issues

**1. Weak Password Policy**
```javascript
// ‚ùå No validation
if (password.length >= 1) { /* OK */ }

// ‚úÖ Strong policy
const isStrong = password.length >= 8 &&
                 /[A-Z]/.test(password) &&
                 /[a-z]/.test(password) &&
                 /[0-9]/.test(password) &&
                 /[^A-Za-z0-9]/.test(password);
```

**2. Credential Stuffing**
- Attacker d√πng leaked username/password t·ª´ site kh√°c
- C·∫ßn: Rate limiting, Account lockout, MFA

**3. Session Issues**
```javascript
// ‚ùå Session kh√¥ng invalidate sau logout
app.post('/logout', (req, res) => {
  res.clearCookie('session');
  res.json({ message: 'Logged out' });
  // Session v·∫´n valid tr√™n server!
});

// ‚úÖ Proper logout
app.post('/logout', (req, res) => {
  req.session.destroy();
  res.clearCookie('session');
  res.json({ message: 'Logged out' });
});
```

**4. JWT Issues**
```javascript
// ‚ùå Kh√¥ng verify signature
const payload = JSON.parse(atob(token.split('.')[1]));

// ‚úÖ Proper verification
const payload = jwt.verify(token, SECRET_KEY);
```

---

## A08: Software and Data Integrity Failures

### M√¥ t·∫£
Kh√¥ng verify integrity c·ªßa software updates, data, ho·∫∑c CI/CD pipeline.

### V√≠ d·ª•

**1. Insecure Deserialization**
```javascript
// ‚ùå Deserialize untrusted data
const obj = JSON.parse(userInput);
obj.__proto__.isAdmin = true; // Prototype pollution!
```

**2. Unsigned Updates**
- Application auto-update m√† kh√¥ng verify signature
- Attacker c√≥ th·ªÉ inject malicious update

**3. CI/CD Pipeline Compromise**
- Build scripts t·ª´ untrusted sources
- Secrets trong pipeline kh√¥ng ƒë∆∞·ª£c protect

---

## A09: Security Logging and Monitoring Failures

### M√¥ t·∫£
Kh√¥ng c√≥ ƒë·ªß logging ƒë·ªÉ detect v√† respond v·ªõi attacks.

### What to Log
```javascript
// Security events c·∫ßn log
logger.info('LOGIN_SUCCESS', { userId, ip, timestamp });
logger.warn('LOGIN_FAILED', { email, ip, timestamp, attempts });
logger.error('AUTH_BYPASS_ATTEMPT', { endpoint, userId, ip });
logger.critical('ADMIN_ACCESS', { action, userId, ip });
```

### What NOT to Log
```javascript
// ‚ùå Sensitive data
logger.info(`User login: ${password}`);
logger.info(`Credit card: ${cardNumber}`);
```

### Best Practices
- Log t·∫•t c·∫£ authentication events
- Log access control failures  
- Log input validation failures
- C√≥ alerting cho suspicious patterns
- ƒê·∫£m b·∫£o logs kh√¥ng b·ªã tampered

---

## A10: Server-Side Request Forgery (SSRF)

### M√¥ t·∫£
Attacker khi·∫øn server g·ª≠i requests ƒë·∫øn unintended locations.

### V√≠ d·ª•
```javascript
// ‚ùå Vulnerable endpoint
app.get('/fetch', async (req, res) => {
  const url = req.query.url;
  const response = await fetch(url);
  res.json(await response.json());
});

// Attacker request:
// GET /fetch?url=http://localhost:6379/  ‚Üê Access internal Redis
// GET /fetch?url=http://169.254.169.254/ ‚Üê AWS metadata
```

### Prevention
```javascript
// ‚úÖ Whitelist allowed hosts
const ALLOWED_HOSTS = ['api.trusted.com', 'cdn.trusted.com'];

app.get('/fetch', async (req, res) => {
  const url = new URL(req.query.url);
  
  if (!ALLOWED_HOSTS.includes(url.hostname)) {
    return res.status(403).json({ error: 'Host not allowed' });
  }
  
  // Also block internal IPs
  if (isInternalIP(url.hostname)) {
    return res.status(403).json({ error: 'Internal hosts not allowed' });
  }
  
  // ... proceed
});
```

---

## üìã Quick Reference Table

| Code | Vulnerability             | One-liner                   |
| ---- | ------------------------- | --------------------------- |
| A01  | Broken Access Control     | Bypass authorization checks |
| A02  | Cryptographic Failures    | Weak/missing encryption     |
| A03  | Injection                 | Malicious input execution   |
| A04  | Insecure Design           | Missing security in design  |
| A05  | Security Misconfiguration | Wrong/default configs       |
| A06  | Vulnerable Components     | Outdated libraries          |
| A07  | Auth Failures             | Weak authentication         |
| A08  | Integrity Failures        | Untrusted data/code         |
| A09  | Logging Failures          | Missing security logs       |
| A10  | SSRF                      | Forge server requests       |

---

## ‚úÖ Checklist

- [ ] Hi·ªÉu v√† c√≥ th·ªÉ explain t·ª´ng vulnerability?
- [ ] Bi·∫øt c√°ch test cho t·ª´ng lo·∫°i?
- [ ] Bi·∫øt prevention measures?
- [ ] ƒê√£ th·ª≠ th·ª±c h√†nh tr√™n labs?

---

## üìñ Practice Labs
- **PortSwigger Academy**: C√≥ labs cho t·ª´ng vulnerability category
- **OWASP WebGoat**: Guided lessons
- **HackTheBox**: Real-world challenges
